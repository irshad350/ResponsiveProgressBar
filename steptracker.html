<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="9z_7YyEZAqhzcKn4qPtOC-TNNj0ZLL6SgHVr9P2AYsM" />
<script src="steps_list.js"></script>
<script src="current_step.js"></script>
</head>
<body>
    <script>

        var activeStations = [];
        var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("width", 1200);
        svg.setAttribute("height", 550);
        var svgNS = svg.namespaceURI;
    
        var pathColor = "#8585ad";
        var pathWidth = 3;
        prepareStationList();
        createPaths(pathColor, pathWidth);
        createCircle();
        createCurveLine(pathColor, pathWidth);
        setText();
        document.body.appendChild(svg);

        function prepareStationList() {
            if(totalStations.length > 24) {
                var currentStationIndex = getCurrentStationIndex();
                if((totalStations.length - currentStationIndex) > 24 ) {
                   
                    for (var i = currentStationIndex-7, j = 0; i < ((currentStationIndex-1) + 24); i++, j++) {
                        activeStations[j] = totalStations[i];
                    }
                } else if ((totalStations.length - currentStationIndex < 24) && (totalStations.length - currentStationIndex > 0)) {
                    
                    var stationsToAppened = currentStationIndex - (24 - (totalStations.length - currentStationIndex));
                    for(var i = stationsToAppened, j = 0; i < (stationsToAppened + 24); i++, j++) {
                        activeStations[j] = totalStations[i];
                    }
                } else {
                   
                    for(var i = (totalStations.length-24), j = 0; i < totalStations.length; i++, j++) {
                        activeStations[j] = totalStations[i];
                    }
                }

            } else {
                activeStations = totalStations;
            }
        }

        function getCurrentStationIndex() {
            var currentStationIdx = 1;
            for (var i = 0; i < totalStations.length; i++) {
                if(currentStation === totalStations[i]) {
                    currentStationIdx = i+1;
                }
            }
            return currentStationIdx;
        }
    
        function createCircle() {
            var isRowEven = false;
            var isCurrentStationFound = false;
            var cx = 0;
            var cy = 70;
            for (var i = 0; i < activeStations.length; i++) {
                if (i != 0 && i % 6 == 0) {
                    cx = 0;
                    cy = cy + 140;
                    isRowEven = !isRowEven;
                    if (isRowEven) {
                        cx = 1162;
                    }
                }
                if (isRowEven) {
                    cx = cx - 166;
                } else {
                    cx = cx + 166;
                }
                
                var newCircle = document.createElementNS(svgNS,'circle');
                newCircle.setAttribute("cx", cx);
                newCircle.setAttribute("cy", cy);
                newCircle.setAttribute("r", "7");
                if (currentStation == activeStations[i]) {
                    newCircle.setAttribute("fill", "#218709");
                    isCurrentStationFound = true;
                } else if (isCurrentStationFound){
                    newCircle.setAttribute("fill", "#8585ad");
                } else {
                    newCircle.setAttribute("fill", "#218709");
                }
                

                svg.appendChild(newCircle);
            }
        }

        function createPaths(pathColor, pathWidth) {
            var oddNumber = 0;
            var isEvenRow = false;
            for(var i = 1; i <= Math.ceil(activeStations.length/6); i ++) {
                var newPath = document.createElementNS(svgNS,'path');
                oddNumber = getNextOddNumber(oddNumber);
                pathYaxis = 70 * oddNumber;
                if (i == Math.ceil(activeStations.length/6) && activeStations.length%6 != 0) {
                    if (isEvenRow) {
                        newPath.setAttributeNS(null, "d", "M  " +(1162 - ((activeStations.length%6)*166)) +" "+ pathYaxis + " H 996");
                    } else {
                        newPath.setAttributeNS(null, "d", "M 166 " + pathYaxis + " H " + (((activeStations.length%6)*166)));
                    }
                } else {
                    newPath.setAttributeNS(null, "d", "M 166 " + pathYaxis + " H 996");
                }
                
                newPath.setAttribute("stroke", pathColor);
                newPath.setAttribute("stroke-width", pathWidth);

                svg.appendChild(newPath);
                isEvenRow = !isEvenRow;
            }
        }

        function createCurveLine(pathColor, pathWidth) {
            if(Math.ceil(activeStations.length/6) >= 2) {
                var rightPath = document.createElementNS(svgNS,'path');
                rightPath.setAttributeNS(null, "d", "M 1003,70 a50,50 0 1,1 0,140");
                rightPath.setAttribute("stroke", pathColor);
                rightPath.setAttribute("stroke-width", pathWidth);
                rightPath.setAttribute("fill", "none");
                svg.appendChild(rightPath);
            }
           
            if(Math.ceil(activeStations.length/6) >= 3) {
                var leftPath = document.createElementNS(svgNS,'path');
                leftPath.setAttributeNS(null, "d", "M 160,350 a50,50 0 1,1 0,-140");
                leftPath.setAttribute("stroke", pathColor);
                leftPath.setAttribute("stroke-width", pathWidth);
                leftPath.setAttribute("fill", "none");
                svg.appendChild(leftPath);
            }
            
            if(Math.ceil(activeStations.length/6) == 4) {
                var rightPath1 = document.createElementNS(svgNS,'path');
                rightPath1.setAttributeNS(null, "d", "M 1003,350 a50,50 0 1,1 0,140");
                rightPath1.setAttribute("stroke", pathColor);
                rightPath1.setAttribute("stroke-width", pathWidth);
                rightPath1.setAttribute("fill", "none");
                svg.appendChild(rightPath1);
            }

        }

        function setText() {
            var isRowEven = false;
            var yAxisUpper = 80;
            var yAxisLower = 5;
            var yAxisIsUpper = false;

            var xAxis = 130;
            for (var i = 0; i < activeStations.length; i++) {
                if (i != 0 && i % 6 == 0) {
                    xAxis = 130;
                    yAxisLower = yAxisLower + 140;
                    yAxisUpper = yAxisUpper + 140;
                    isRowEven = !isRowEven;
                    if (isRowEven) {
                        xAxis = 960;
                        yAxisIsUpper = true;
                    } else {
                        yAxisIsUpper = false;
                    }
                }
                var yAxis = 0;
                if (isRowEven) {
                    if (yAxisIsUpper) {
                        yAxis = yAxisUpper;
                        yAxisIsUpper = !yAxisIsUpper;
                    } else {
                        yAxis = yAxisLower
                        yAxisIsUpper = !yAxisIsUpper;
                    }
                } else {
                    if (!yAxisIsUpper) {
                        yAxis = yAxisUpper;
                        yAxisIsUpper = !yAxisIsUpper;
                    } else {
                        yAxis = yAxisLower;
                        yAxisIsUpper = !yAxisIsUpper;
                    }
                }
                var foreignObject = document.createElementNS(svgNS,'foreignObject');
                foreignObject.setAttribute("x", xAxis);
                foreignObject.setAttribute("y", yAxis);
                foreignObject.setAttribute("width", 190);
                foreignObject.setAttribute("height", 50);
                foreignObject.innerHTML = "<div xmlns='http://www.w3.org/1999/xhtml' style='height: 3em;display: flex;align-items: center'>" + activeStations[i] + "</div>";
                svg.appendChild(foreignObject);
                if (isRowEven) {
                    xAxis = xAxis - 166;
                } else {
                    xAxis = xAxis + 166;
                }
            }
        }

        function getNextOddNumber(currentOddNumber) {
            if (currentOddNumber == 0) 
                return 1;
            else return currentOddNumber + 2;
        }
    
    </script>
</body>
</html>
